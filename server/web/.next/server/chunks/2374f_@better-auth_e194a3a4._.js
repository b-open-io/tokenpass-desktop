module.exports=[54343,e=>{"use strict";function t(e){switch(e){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw Error(`Unsupported alphabet: ${e}`)}}function r(...e){let a=e.map(t).join("");if(0===a.length)throw Error("No valid characters provided for random string generation.");let i=a.length;return(e,...r)=>{let n;if(e<=0)throw Error("Length must be a positive integer.");let d=a,o=i;r.length>0&&(o=(d=r.map(t).join("")).length);let s=Math.floor(256/o)*o,l=new Uint8Array(2*e),u=l.length,f="",c=u;for(;f.length<e;)c>=u&&(crypto.getRandomValues(l),c=0),(n=l[c++])<s&&(f+=d[n%o]);return f}}e.s(["createRandomStringGenerator",()=>r])},20399,32749,e=>{"use strict";function t(e){return e}function r(e,t,r){let a=!1;return function(...i){return a||((r?.warn??console.warn)(`[Deprecation] ${t}`),a=!0),e.apply(this,i)}}e.s(["defineErrorCodes",()=>t],20399),e.s(["deprecate",()=>r],32749)},56667,e=>{"use strict";var t=e.i(54343);let r=e=>(0,t.createRandomStringGenerator)("a-z","A-Z","0-9")(e||32);e.s(["generateId",()=>r])},76365,38722,34395,93012,e=>{"use strict";let t=Object.create(null),r=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?t:globalThis),a=new Proxy(t,{get:(e,a)=>r()[a]??t[a],has:(e,a)=>a in r()||a in t,set:(e,t,a)=>(r(!0)[t]=a,!0),deleteProperty(e,t){if(!t)return!1;let a=r(!0);return delete a[t],!0},ownKeys:()=>Object.keys(r(!0))}),i="u">typeof process&&process.env&&"production"||"",n="production"===i,d=()=>"dev"===i||"development"===i,o=()=>{var e;return"test"===i||!!(e=a.TEST)&&"false"!==e};function s(e,t){return"u">typeof process&&process.env?process.env[e]??t:"u">typeof Deno?Deno.env.get(e)??t:"u">typeof Bun?Bun.env[e]??t:t}function l(e,t=!0){let r=s(e);return r?"0"!==r&&"false"!==r.toLowerCase()&&""!==r:t}let u=Object.freeze({get BETTER_AUTH_SECRET(){return s("BETTER_AUTH_SECRET")},get AUTH_SECRET(){return s("AUTH_SECRET")},get BETTER_AUTH_TELEMETRY(){return s("BETTER_AUTH_TELEMETRY")},get BETTER_AUTH_TELEMETRY_ID(){return s("BETTER_AUTH_TELEMETRY_ID")},get NODE_ENV(){return s("NODE_ENV","development")},get PACKAGE_VERSION(){return s("PACKAGE_VERSION","0.0.0")},get BETTER_AUTH_TELEMETRY_ENDPOINT(){return s("BETTER_AUTH_TELEMETRY_ENDPOINT","https://telemetry.better-auth.com/v1/track")}});e.s(["ENV",()=>u,"env",()=>a,"getBooleanEnvVar",()=>l,"getEnvVar",()=>s,"isDevelopment",()=>d,"isProduction",()=>n,"isTest",()=>o,"nodeENV",()=>i],38722);let f={eterm:4,cons25:4,console:4,cygwin:4,dtterm:4,gnome:4,hurd:4,jfbterm:4,konsole:4,kterm:4,mlterm:4,mosh:24,putty:4,st:4,"rxvt-unicode-24bit":24,terminator:24,"xterm-kitty":24},c=new Map(Object.entries({APPVEYOR:8,BUILDKITE:8,CIRCLECI:24,DRONE:8,GITEA_ACTIONS:24,GITHUB_ACTIONS:24,GITLAB_CI:8,TRAVIS:8})),m=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function p(){if(void 0!==s("FORCE_COLOR"))switch(s("FORCE_COLOR")){case"":case"1":case"true":return 4;case"2":return 8;case"3":return 24;default:return 1}if(void 0!==s("NODE_DISABLE_COLORS")&&""!==s("NODE_DISABLE_COLORS")||void 0!==s("NO_COLOR")&&""!==s("NO_COLOR")||"dumb"===s("TERM"))return 1;if(s("TMUX"))return 24;if("TF_BUILD"in a&&"AGENT_NAME"in a)return 4;if("CI"in a){for(let{0:e,1:t}of c)if(e in a)return t;return"codeship"===s("CI_NAME")?8:1}if("TEAMCITY_VERSION"in a)return null!==/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(s("TEAMCITY_VERSION"))?4:1;switch(s("TERM_PROGRAM")){case"iTerm.app":if(!s("TERM_PROGRAM_VERSION")||null!==/^[0-2]\./.exec(s("TERM_PROGRAM_VERSION")))return 8;return 24;case"HyperTerm":case"MacTerm":return 24;case"Apple_Terminal":return 8}if("truecolor"===s("COLORTERM")||"24bit"===s("COLORTERM"))return 24;if(s("TERM")){if(null!==/truecolor/.exec(s("TERM")))return 24;if(null!==/^xterm-256/.exec(s("TERM")))return 8;let e=s("TERM").toLowerCase();if(f[e])return f[e];if(m.some(t=>null!==t.exec(e)))return 4}return s("COLORTERM")?4:1}e.s(["getColorDepth",()=>p],34395);let g={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",undim:"\x1b[22m",underscore:"\x1b[4m",blink:"\x1b[5m",reverse:"\x1b[7m",hidden:"\x1b[8m",fg:{black:"\x1b[30m",red:"\x1b[31m",green:"\x1b[32m",yellow:"\x1b[33m",blue:"\x1b[34m",magenta:"\x1b[35m",cyan:"\x1b[36m",white:"\x1b[37m"},bg:{black:"\x1b[40m",red:"\x1b[41m",green:"\x1b[42m",yellow:"\x1b[43m",blue:"\x1b[44m",magenta:"\x1b[45m",cyan:"\x1b[46m",white:"\x1b[47m"}},y=["debug","info","success","warn","error"];function A(e,t){return y.indexOf(t)>=y.indexOf(e)}let E={info:g.fg.blue,success:g.fg.green,warn:g.fg.yellow,error:g.fg.red,debug:g.fg.magenta},b=e=>{let t=e?.disabled!==!0,r=e?.level??"error",a=e?.disableColors!==void 0?!e.disableColors:1!==p();return{...Object.fromEntries(y.map(i=>[i,(...[n,...d])=>((i,n,d=[])=>{let o;if(!t||!A(r,i))return;let s=(o=new Date().toISOString(),a?`${g.dim}${o}${g.reset} ${E[i]}${i.toUpperCase()}${g.reset} ${g.bright}[Better Auth]:${g.reset} ${n}`:`${o} ${i.toUpperCase()} [Better Auth]: ${n}`);e&&"function"==typeof e.log?e.log("success"===i?"info":i,n,...d):"error"===i?console.error(s,...d):"warn"===i?console.warn(s,...d):console.log(s,...d)})(i,n,d)])),get level(){return r}}},T=b();e.s(["TTY_COLORS",()=>g,"createLogger",()=>b,"levels",()=>y,"logger",()=>T,"shouldPublishLog",()=>A],93012),e.s([],76365)},6928,75722,75973,21228,e=>{"use strict";var t=e.i(20399);e.i(32749),e.i(56667);var r=e.i(93012);function a(e){try{if("string"!=typeof e)return e;return JSON.parse(e,function(e,t){if("string"==typeof t&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(t)){let e=new Date(t);if(!isNaN(e.getTime()))return e}return t})}catch(e){return r.logger.error("Error parsing JSON",{error:e}),null}}e.i(76365),e.s(["safeJSONParse",()=>a],75722),e.s([],75973);let i=(0,t.defineErrorCodes)({USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"Invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists.",USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:"User already exists. Use another email.",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found",USER_ALREADY_HAS_PASSWORD:"User already has a password. Provide that to delete the account.",CROSS_SITE_NAVIGATION_LOGIN_BLOCKED:"Cross-site navigation login blocked. This request appears to be a CSRF attack.",VERIFICATION_EMAIL_NOT_ENABLED:"Verification email isn't enabled",EMAIL_ALREADY_VERIFIED:"Email is already verified",EMAIL_MISMATCH:"Email mismatch",SESSION_NOT_FRESH:"Session is not fresh",LINKED_ACCOUNT_ALREADY_EXISTS:"Linked account already exists",INVALID_ORIGIN:"Invalid origin",INVALID_CALLBACK_URL:"Invalid callbackURL",INVALID_REDIRECT_URL:"Invalid redirectURL",INVALID_ERROR_CALLBACK_URL:"Invalid errorCallbackURL",INVALID_NEW_USER_CALLBACK_URL:"Invalid newUserCallbackURL",MISSING_OR_NULL_ORIGIN:"Missing or null Origin",CALLBACK_URL_REQUIRED:"callbackURL is required",FAILED_TO_CREATE_VERIFICATION:"Unable to create verification",FIELD_NOT_ALLOWED:"Field not allowed to be set",ASYNC_VALIDATION_NOT_SUPPORTED:"Async validation is not supported",VALIDATION_ERROR:"Validation Error",MISSING_FIELD:"Field is required"});e.s(["BASE_ERROR_CODES",()=>i],21228);var n=class extends Error{constructor(e,t){super(e,t),this.name="BetterAuthError",this.message=e,this.stack=""}};e.s(["BetterAuthError",()=>n],6928)},99919,e=>{"use strict";let t=e=>{let t=(e.plugins??[]).reduce((e,t)=>{let r=t.schema;if(!r)return e;for(let[t,a]of Object.entries(r))e[t]={fields:{...e[t]?.fields,...a.fields},modelName:a.modelName||t};return e},{}),r=e.rateLimit?.storage==="database",a={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",bigint:!0,fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:i,session:n,account:d,verification:o,...s}=t,l={session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,index:!0},...n?.fields,...e.session?.additionalFields},order:2}};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name",sortable:!0},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email",sortable:!0},emailVerified:{type:"boolean",defaultValue:!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified",input:!1},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,onUpdate:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...i?.fields,...e.user?.additionalFields},order:1},...!e.secondaryStorage||e.session?.storeSessionInDatabase?l:{},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId",index:!0},accessToken:{type:"string",required:!1,returned:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,returned:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,returned:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,returned:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,returned:!1,fieldName:e.account?.fields?.refreshTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,returned:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},...d?.fields,...e.account?.additionalFields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier",index:!0},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!0,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,defaultValue:()=>new Date,onUpdate:()=>new Date,fieldName:e.verification?.fields?.updatedAt||"updatedAt"},...o?.fields,...e.verification?.additionalFields},order:4},...s,...r?a:{}}};e.s(["getAuthTables",()=>t])},59642,10441,55902,34276,64349,45508,3527,e=>{"use strict";var t=e.i(6928);let r=({usePlural:e,schema:r})=>a=>{if(e&&"s"===a.charAt(a.length-1)){let e=a.slice(0,-1),t=r[e]?e:void 0;if(t||(t=Object.entries(r).find(([t,r])=>r.modelName===e)?.[0]),t)return t}let i=r[a]?a:void 0;if(i||(i=Object.entries(r).find(([e,t])=>t.modelName===a)?.[0]),!i)throw new t.BetterAuthError(`Model "${a}" not found in schema`);return i};e.s(["initGetDefaultModelName",()=>r],59642);let a=({schema:e,usePlural:a})=>{let i=r({schema:e,usePlural:a});return({field:r,model:a})=>{if("id"===r||"_id"===r)return"id";let n=i(a),d=e[n]?.fields[r];if(!d){let t=Object.entries(e[n].fields).find(([e,t])=>t.fieldName===r);t&&(d=t[1],r=t[0])}if(!d)throw new t.BetterAuthError(`Field ${r} not found in model ${n}`);return r}};e.s(["initGetDefaultFieldName",()=>a],10441);var i=e.i(93012);e.i(76365);var n=e.i(56667);e.i(75973);let d=({usePlural:e,schema:t,disableIdGeneration:a,options:d,customIdGenerator:o,supportsUUIDs:s})=>{let l=r({usePlural:e,schema:t});return({customModelName:e,forceAllowId:t})=>{let r=d.advanced?.database?.useNumberId||d.advanced?.database?.generateId==="serial",u=d.advanced?.database?.generateId==="uuid",f=!a&&(!r||!!t)&&(!u||!s),c=l(e??"id");return{type:r?"number":"string",required:!!f,...f?{defaultValue(){if(a)return;let e=d.advanced?.database?.generateId;if(!1!==e&&!r)return"function"==typeof e?e({model:c}):o?o({model:c}):"uuid"===e?crypto.randomUUID():(0,n.generateId)()}}:{},transform:{input:e=>{if(e){if(r){let t=Number(e);if(isNaN(t))return;return t}if(u){if(f&&!t)return e;if(a||s)return;if(t&&"string"==typeof e)if(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e))return e;else{let e=Error().stack?.split("\n").filter((e,t)=>1!==t).join("\n").replace("Error:","");i.logger.warn("[Adapter Factory] - Invalid UUID value for field `id` provided when `forceAllowId` is true. Generating a new UUID.",e)}return"string"==typeof e||s?void 0:crypto.randomUUID()}return e}},output:e=>{if(e)return String(e)}}}}};e.s(["initGetIdField",()=>d],55902);let o=({usePlural:e,schema:i,options:n,customIdGenerator:o,disableIdGeneration:s})=>{let l=r({usePlural:e,schema:i}),u=a({usePlural:e,schema:i}),f=d({usePlural:e,schema:i,options:n,customIdGenerator:o,disableIdGeneration:s});return({model:e,field:r})=>{let a=l(e),n=u({field:r,model:a}),d=i[a].fields;d.id=f({customModelName:a});let o=d[n];if(!o)throw new t.BetterAuthError(`Field ${r} not found in model ${e}`);return o}};e.s(["initGetFieldAttributes",()=>o],34276);let s=({schema:e,usePlural:t})=>{let i=r({schema:e,usePlural:t}),n=a({schema:e,usePlural:t});return function({model:t,field:r}){let a=i(t),d=n({model:a,field:r});return e[a]?.fields[d]?.fieldName||d}};e.s(["initGetFieldName",()=>s],64349);let l=({usePlural:e,schema:t})=>{let a=r({schema:t,usePlural:e});return r=>{let i=a(r);return t&&t[i]&&t[i].modelName!==r?e?`${t[i].modelName}s`:t[i].modelName:e?`${r}s`:r}};function u(e,t,r){if("update"===r)return void 0===e&&void 0!==t.onUpdate?"function"==typeof t.onUpdate?t.onUpdate():t.onUpdate:e;return"create"===r&&(void 0===e||!0===t.required&&null===e)&&void 0!==t.defaultValue?"function"==typeof t.defaultValue?t.defaultValue():t.defaultValue:e}function f(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}e.s(["initGetModelName",()=>l],45508),e.s(["deepmerge",()=>function e(t,r){if(Array.isArray(t)&&Array.isArray(r))return[...t,...r];if(f(t)&&f(r)){let a={...t};for(let[i,n]of Object.entries(r))void 0!==n&&(i in t?a[i]=e(t[i],n):a[i]=n);return a}return r},"withApplyDefault",()=>u],3527)},69138,98113,e=>{"use strict";var t=e.i(59642),r=e.i(10441),a=e.i(55902),i=e.i(34276),n=e.i(64349),d=e.i(45508),o=e.i(3527),s=e.i(99919),l=e.i(34395),u=e.i(93012);e.i(76365);var f=e.i(75722),c=e.i(6928);let m=[],p=-1,g=({adapter:e,config:l})=>g=>{let T=Math.random().toString(36).substring(2,15),N={...l,supportsBooleans:l.supportsBooleans??!0,supportsDates:l.supportsDates??!0,supportsJSON:l.supportsJSON??!1,adapterName:l.adapterName??l.adapterId,supportsNumericIds:l.supportsNumericIds??!0,supportsUUIDs:l.supportsUUIDs??!1,supportsArrays:l.supportsArrays??!1,transaction:l.transaction??!1,disableTransformInput:l.disableTransformInput??!1,disableTransformOutput:l.disableTransformOutput??!1,disableTransformJoin:l.disableTransformJoin??!1};if((g.advanced?.database?.useNumberId===!0||g.advanced?.database?.generateId==="serial")&&!1===N.supportsNumericIds)throw new c.BetterAuthError(`[${N.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);let I=(0,s.getAuthTables)(g),O=(...e)=>{if(!0===N.debugLogs||"object"==typeof N.debugLogs){let t=(0,u.createLogger)({level:"info"});if("object"==typeof N.debugLogs&&"isRunningAdapterTests"in N.debugLogs){N.debugLogs.isRunningAdapterTests&&(e.shift(),m.push({instance:T,args:e}));return}if("object"!=typeof N.debugLogs||!N.debugLogs.logCondition||N.debugLogs.logCondition?.())if("object"==typeof e[0]&&"method"in e[0]){let r=e.shift().method;if("object"==typeof N.debugLogs){if("create"===r&&!N.debugLogs.create)return;else if("update"===r&&!N.debugLogs.update)return;else if("updateMany"===r&&!N.debugLogs.updateMany)return;else if("findOne"===r&&!N.debugLogs.findOne)return;else if("findMany"===r&&!N.debugLogs.findMany)return;else if("delete"===r&&!N.debugLogs.delete)return;else if("deleteMany"===r&&!N.debugLogs.deleteMany)return;else if("count"===r&&!N.debugLogs.count)return}t.info(`[${N.adapterName}]`,...e)}else t.info(`[${N.adapterName}]`,...e)}},_=(0,u.createLogger)(g.logger),h=(0,t.initGetDefaultModelName)({usePlural:N.usePlural,schema:I}),R=(0,r.initGetDefaultFieldName)({usePlural:N.usePlural,schema:I}),L=(0,d.initGetModelName)({usePlural:N.usePlural,schema:I}),$=(0,n.initGetFieldName)({schema:I,usePlural:N.usePlural}),D=(0,a.initGetIdField)({schema:I,options:g,usePlural:N.usePlural,disableIdGeneration:N.disableIdGeneration,customIdGenerator:N.customIdGenerator,supportsUUIDs:N.supportsUUIDs}),w=(0,i.initGetFieldAttributes)({schema:I,options:g,usePlural:N.usePlural,disableIdGeneration:N.disableIdGeneration,customIdGenerator:N.customIdGenerator}),v=async(e,t,r,a)=>{let i={},n=I[t].fields,d=N.mapKeysTransformInput??{},s=g.advanced?.database?.useNumberId||g.advanced?.database?.generateId==="serial";for(let l in n.id=D({customModelName:t,forceAllowId:a&&"id"in e}),n){let a=e[l],u=n[l],f=d[l]||n[l].fieldName||l;if(void 0===a&&(void 0===u.defaultValue&&!u.transform?.input&&!("update"===r&&u.onUpdate)||"update"===r&&!u.onUpdate))continue;if(u&&"date"===u.type&&!(a instanceof Date)&&"string"==typeof a)try{a=new Date(a)}catch{_.error("[Adapter Factory] Failed to convert string to date",{value:a,field:l})}let c=(0,o.withApplyDefault)(a,u,r);u.transform?.input&&(c=await u.transform.input(c)),u.references?.field==="id"&&s?c=Array.isArray(c)?c.map(e=>null!==e?Number(e):null):null!==c?Number(c):null:!1===N.supportsJSON&&"object"==typeof c&&"json"===u.type||!1===N.supportsArrays&&Array.isArray(c)&&("string[]"===u.type||"number[]"===u.type)?c=JSON.stringify(c):!1===N.supportsDates&&c instanceof Date&&"date"===u.type?c=c.toISOString():!1===N.supportsBooleans&&"boolean"==typeof c&&(c=+!!c),N.customTransformInput&&(c=N.customTransformInput({data:c,action:r,field:f,fieldAttributes:u,model:L(t),schema:I,options:g})),void 0!==c&&(i[f]=c)}return i},S=async(e,t,r=[],a)=>{let i=async(e,t,r=[])=>{if(!e)return null;let a=N.mapKeysTransformOutput??{},i={},n=I[h(t)].fields;for(let d in n[Object.entries(a).find(([e,t])=>"id"===t)?.[0]??"id"]={type:g.advanced?.database?.useNumberId||g.advanced?.database?.generateId==="serial"?"number":"string"},n){if(r.length&&!r.includes(d))continue;let o=n[d];if(o){let n=o.fieldName||d,s=e[Object.entries(a).find(([e,t])=>t===n)?.[0]||n];o.transform?.output&&(s=await o.transform.output(s));let l=a[d]||d;"id"===n||o.references?.field==="id"?null!=s&&(s=String(s)):!1===N.supportsJSON&&"string"==typeof s&&"json"===o.type||!1===N.supportsArrays&&"string"==typeof s&&("string[]"===o.type||"number[]"===o.type)?s=(0,f.safeJSONParse)(s):!1===N.supportsDates&&"string"==typeof s&&"date"===o.type?s=new Date(s):!1===N.supportsBooleans&&"number"==typeof s&&"boolean"===o.type&&(s=1===s),N.customTransformOutput&&(s=N.customTransformOutput({data:s,field:l,fieldAttributes:o,select:r,model:L(t),schema:I,options:g})),i[l]=s}}return i};if(!a||0===Object.keys(a).length)return await i(e,t,r);t=h(t);let n=await i(e,t,r),d=Object.entries(a).map(([e,t])=>({modelName:L(e),defaultModelName:h(e),joinConfig:t}));if(!e)return null;for(let{modelName:r,defaultModelName:a,joinConfig:o}of d){let d=await (async()=>g.experimental?.joins?e[r]:await C({baseModel:t,baseData:n,joinModel:r,specificJoinConfig:o}))();null==d&&(d="one-to-one"===o.relation?null:[]),"one-to-many"!==o.relation||Array.isArray(d)||(d=[d]);let s=[];if(Array.isArray(d))for(let e of d){let t=await i(e,r,[]);s.push(t)}else{let e=await i(d,r,[]);s.push(e)}n[a]=("one-to-one"===o.relation?s[0]:s)??null}return n},U=({model:e,where:t,action:r})=>{if(!t)return;let a=N.mapKeysTransformInput??{};return t.map(t=>{let{field:i,value:n,operator:d="eq",connector:o="AND"}=t;if("in"===d&&!Array.isArray(n))throw new c.BetterAuthError("Value must be an array");let s=n,l=h(e),u=R({field:i,model:e}),f=a[u]||$({field:u,model:l}),m=w({field:u,model:l}),p=g.advanced?.database?.useNumberId||g.advanced?.database?.generateId==="serial";if(("id"===u||m.references?.field==="id")&&p&&(s=Array.isArray(n)?n.map(Number):Number(n)),"date"===m.type&&n instanceof Date&&!N.supportsDates&&(s=n.toISOString()),"boolean"!==m.type||"boolean"!=typeof n||N.supportsBooleans||(s=+!!n),"json"===m.type&&"object"==typeof n&&!N.supportsJSON)try{s=JSON.stringify(n)}catch(e){throw Error(`Failed to stringify JSON value for field ${f}`,{cause:e})}return N.customTransformInput&&(s=N.customTransformInput({data:s,fieldAttributes:m,field:f,model:L(e),schema:I,options:g,action:r})),{operator:d,connector:o,field:f,value:s}})},M=(e,t,r)=>{if(!t||0===Object.keys(t).length)return;let a={};for(let[i,n]of Object.entries(t)){let t,d,o;if(!n)continue;let s=h(i),l=h(e),u=Object.entries(I[s].fields).filter(([e,t])=>t.references&&h(t.references.model)===l),f=!0;if(u.length||(u=Object.entries(I[l].fields).filter(([e,t])=>t.references&&h(t.references.model)===s),f=!1),u.length){if(u.length>1)throw new c.BetterAuthError(`Multiple foreign keys found for model ${i} and base model ${e} while performing join operation. Only one foreign key is supported.`)}else throw new c.BetterAuthError(`No foreign key found for model ${i} and base model ${e} while performing join operation.`);let[m,p]=u[0];if(!p.references)throw new c.BetterAuthError(`No references found for foreign key ${m} on model ${i} while performing join operation.`);f?(t=$({model:e,field:o=p.references.field}),d=$({model:i,field:m})):(t=$({model:e,field:o=m}),d=$({model:i,field:p.references.field})),r&&!r.includes(o)&&r.push(o);let y="id"===d||(p.unique??!1),A=g.advanced?.database?.defaultFindManyLimit??100;y?A=1:"object"==typeof n&&"number"==typeof n.limit&&(A=n.limit),a[L(i)]={on:{from:t,to:d},limit:A,relation:y?"one-to-one":"one-to-many"}}return{join:a,select:r}},C=async({baseModel:e,baseData:t,joinModel:r,specificJoinConfig:a})=>{let i;if(!t)return t;let n=L(r),d=a.on.to,o=t[R({field:a.on.from,model:e})];if(null==o)return"one-to-one"===a.relation?null:[];let s=U({model:n,where:[{field:d,value:o,operator:"eq",connector:"AND"}],action:"findOne"});try{if("one-to-one"===a.relation)i=await x.findOne({model:n,where:s});else{let e=a.limit??g.advanced?.database?.defaultFindManyLimit??100;i=await x.findMany({model:n,where:s,limit:e})}}catch(e){throw _.error(`Failed to query fallback join for model ${n}:`,{where:s,limit:a.limit}),console.error(e),e}return i},x=e({options:g,schema:I,debugLog:O,getFieldName:$,getModelName:L,getDefaultModelName:h,getDefaultFieldName:R,getFieldAttributes:w,transformInput:v,transformOutput:S,transformWhereClause:U}),k=null,F={transaction:async e=>{if(!k)if(N.transaction)_.debug(`[${N.adapterName}] - Using provided transaction implementation.`),k=N.transaction;else k=e=>e(F);return k(e)},create:async({data:e,model:t,select:r,forceAllowId:a=!1})=>{let i=++p,n=L(t);t=h(t),"id"in e&&void 0!==e.id&&!a&&(_.warn(`[${N.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \`forceAllowId\` parameter. The id will be ignored.`),console.log(Error().stack?.split("\n").filter((e,t)=>1!==t).join("\n").replace("Error:","Create method with `id` being called at:")),e.id=void 0),O({method:"create"},`${y(i)} ${A(1,4)}`,`${E("create")} ${b("Unsafe Input")}:`,{model:n,data:e});let d=e;N.disableTransformInput||(d=await v(e,t,"create",a)),O({method:"create"},`${y(i)} ${A(2,4)}`,`${E("create")} ${b("Parsed Input")}:`,{model:n,data:d});let o=await x.create({data:d,model:n});O({method:"create"},`${y(i)} ${A(3,4)}`,`${E("create")} ${b("DB Result")}:`,{model:n,res:o});let s=o;return N.disableTransformOutput||(s=await S(o,t,r,void 0)),O({method:"create"},`${y(i)} ${A(4,4)}`,`${E("create")} ${b("Parsed Result")}:`,{model:n,data:s}),s},update:async({model:e,where:t,update:r})=>{let a=++p,i=L(e=h(e)),n=U({model:e,where:t,action:"update"});O({method:"update"},`${y(a)} ${A(1,4)}`,`${E("update")} ${b("Unsafe Input")}:`,{model:i,data:r});let d=r;N.disableTransformInput||(d=await v(r,e,"update")),O({method:"update"},`${y(a)} ${A(2,4)}`,`${E("update")} ${b("Parsed Input")}:`,{model:i,data:d});let o=await x.update({model:i,where:n,update:d});O({method:"update"},`${y(a)} ${A(3,4)}`,`${E("update")} ${b("DB Result")}:`,{model:i,data:o});let s=o;return N.disableTransformOutput||(s=await S(o,e,void 0,void 0)),O({method:"update"},`${y(a)} ${A(4,4)}`,`${E("update")} ${b("Parsed Result")}:`,{model:i,data:s}),s},updateMany:async({model:e,where:t,update:r})=>{let a=++p,i=L(e),n=U({model:e,where:t,action:"updateMany"});e=h(e),O({method:"updateMany"},`${y(a)} ${A(1,4)}`,`${E("updateMany")} ${b("Unsafe Input")}:`,{model:i,data:r});let d=r;N.disableTransformInput||(d=await v(r,e,"update")),O({method:"updateMany"},`${y(a)} ${A(2,4)}`,`${E("updateMany")} ${b("Parsed Input")}:`,{model:i,data:d});let o=await x.updateMany({model:i,where:n,update:d});return O({method:"updateMany"},`${y(a)} ${A(3,4)}`,`${E("updateMany")} ${b("DB Result")}:`,{model:i,data:o}),O({method:"updateMany"},`${y(a)} ${A(4,4)}`,`${E("updateMany")} ${b("Parsed Result")}:`,{model:i,data:o}),o},findOne:async({model:e,where:t,select:r,join:a})=>{let i,n=++p,d=L(e),o=U({model:e,where:t,action:"findOne"});e=h(e);let s=!0;if(N.disableTransformJoin)i=a;else{let t=M(e,a,r);t&&(i=t.join,r=t.select),!g.experimental?.joins&&i&&Object.keys(i).length>0&&(s=!1)}O({method:"findOne"},`${y(n)} ${A(1,3)}`,`${E("findOne")}:`,{model:d,where:o,select:r,join:i});let l=await x.findOne({model:d,where:o,select:r,join:s?i:void 0});O({method:"findOne"},`${y(n)} ${A(2,3)}`,`${E("findOne")} ${b("DB Result")}:`,{model:d,data:l});let u=l;return N.disableTransformOutput||(u=await S(l,e,r,i)),O({method:"findOne"},`${y(n)} ${A(3,3)}`,`${E("findOne")} ${b("Parsed Result")}:`,{model:d,data:u}),u},findMany:async({model:e,where:t,limit:r,sortBy:a,offset:i,join:n})=>{let d,o=++p,s=r??g.advanced?.database?.defaultFindManyLimit??100,l=L(e),u=U({model:e,where:t,action:"findMany"});e=h(e);let f=!0;if(N.disableTransformJoin)d=n;else{let t=M(e,n,void 0);t&&(d=t.join),!g.experimental?.joins&&d&&Object.keys(d).length>0&&(f=!1)}O({method:"findMany"},`${y(o)} ${A(1,3)}`,`${E("findMany")}:`,{model:l,where:u,limit:s,sortBy:a,offset:i,join:d});let c=await x.findMany({model:l,where:u,limit:s,sortBy:a,offset:i,join:f?d:void 0});O({method:"findMany"},`${y(o)} ${A(2,3)}`,`${E("findMany")} ${b("DB Result")}:`,{model:l,data:c});let m=c;return N.disableTransformOutput||(m=await Promise.all(c.map(async t=>await S(t,e,void 0,d)))),O({method:"findMany"},`${y(o)} ${A(3,3)}`,`${E("findMany")} ${b("Parsed Result")}:`,{model:l,data:m}),m},delete:async({model:e,where:t})=>{let r=++p,a=L(e),i=U({model:e,where:t,action:"delete"});e=h(e),O({method:"delete"},`${y(r)} ${A(1,2)}`,`${E("delete")}:`,{model:a,where:i}),await x.delete({model:a,where:i}),O({method:"delete"},`${y(r)} ${A(2,2)}`,`${E("delete")} ${b("DB Result")}:`,{model:a})},deleteMany:async({model:e,where:t})=>{let r=++p,a=L(e),i=U({model:e,where:t,action:"deleteMany"});e=h(e),O({method:"deleteMany"},`${y(r)} ${A(1,2)}`,`${E("deleteMany")} ${b("DeleteMany")}:`,{model:a,where:i});let n=await x.deleteMany({model:a,where:i});return O({method:"deleteMany"},`${y(r)} ${A(2,2)}`,`${E("deleteMany")} ${b("DB Result")}:`,{model:a,data:n}),n},count:async({model:e,where:t})=>{let r=++p,a=L(e),i=U({model:e,where:t,action:"count"});e=h(e),O({method:"count"},`${y(r)} ${A(1,2)}`,`${E("count")}:`,{model:a,where:i});let n=await x.count({model:a,where:i});return O({method:"count"},`${y(r)} ${A(2,2)}`,`${E("count")}:`,{model:a,data:n}),n},createSchema:x.createSchema?async(e,t)=>{let r=(0,s.getAuthTables)(g);return g.secondaryStorage&&!g.session?.storeSessionInDatabase&&delete r.session,g.rateLimit&&"database"===g.rateLimit.storage&&(void 0===g.rateLimit.enabled||!0===g.rateLimit.enabled)&&(r.ratelimit={modelName:g.rateLimit.modelName??"ratelimit",fields:{key:{type:"string",unique:!0,required:!0,fieldName:g.rateLimit.fields?.key??"key"},count:{type:"number",required:!0,fieldName:g.rateLimit.fields?.count??"count"},lastRequest:{type:"number",required:!0,bigint:!0,defaultValue:()=>Date.now(),fieldName:g.rateLimit.fields?.lastRequest??"lastRequest"}}}),x.createSchema({file:t,tables:r})}:void 0,options:{adapterConfig:N,...x.options??{}},id:N.adapterId,...N.debugLogs?.isRunningAdapterTests?{adapterTestDebugLogs:{resetDebugLogs(){m=m.filter(e=>e.instance!==T)},printDebugLogs(){let e=`â”€`.repeat(80),t=m.filter(e=>e.instance===T);0===t.length||console.log(...t.reverse().map(e=>(e.args[0]=`
${e.args[0]}`,[...e.args,"\n"])).reduce((e,t)=>[...t,...e],[`
${e}`]))}}}:{}};return F};function y(e){return 8>(0,l.getColorDepth)()?`#${e}`:`${u.TTY_COLORS.fg.magenta}#${e}${u.TTY_COLORS.reset}`}function A(e,t){return`${u.TTY_COLORS.bg.black}${u.TTY_COLORS.fg.yellow}[${e}/${t}]${u.TTY_COLORS.reset}`}function E(e){return`${u.TTY_COLORS.bright}${e}${u.TTY_COLORS.reset}`}function b(e){return`${u.TTY_COLORS.dim}(${e})${u.TTY_COLORS.reset}`}e.s(["createAdapter",()=>g,"createAdapterFactory",()=>g],98113),e.s([],69138)}];

//# sourceMappingURL=2374f_%40better-auth_e194a3a4._.js.map